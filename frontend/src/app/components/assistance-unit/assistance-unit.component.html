<div class="page-shell">
  <div class="card hero-card">
    <div>
      <p class="eyebrow">Unidade assistencial</p>
      <h2>Cadastro da unidade</h2>
      <p class="subtitle">Organize as informações institucionais e mantenha os dados sempre atualizados.</p>
    </div>
    <div class="badge-pill">Dados institucionais</div>
  </div>

  <div class="card card--compact">
    <div class="card__header">Cadastro de Unidade Assistencial</div>
    <p class="text-sm text-slate-600">
      Apenas uma unidade pode ser cadastrada. Utilize os campos abaixo para manter os dados gerais atualizados.
    </p>

    <form [formGroup]="form" class="compact-form" (ngSubmit)="save()">
      <div class="grid grid-cols-1 md:grid-cols-2 compact-grid">
        <div class="field-stack md:col-span-2">
          <label class="text-sm font-medium text-slate-700" for="nomeFantasia">Nome fantasia</label>
          <input id="nomeFantasia" type="text" formControlName="nomeFantasia" class="input" placeholder="Ex.: Unidade Central" />
          <p *ngIf="form.get('nomeFantasia')?.touched && form.get('nomeFantasia')?.invalid" class="text-xs text-red-500">
            Informe um nome fantasia válido para a unidade.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 compact-grid md:col-span-2">
          <div class="field-stack">
            <label class="text-sm font-medium text-slate-700" for="logomarca">Logomarca (exibida na tela de login)</label>
            <div class="flex flex-col md:flex-row md:items-center gap-3">
              <div class="flex items-center gap-3">
                <input
                  id="logomarca"
                  type="file"
                  accept="image/*"
                  class="input"
                  (change)="onLogoSelected($event)"
                />
                <button type="button" class="btn-outline" (click)="clearLogo()" *ngIf="logoPreview">Remover</button>
              </div>
              <div *ngIf="logoPreview" class="bg-slate-50 border border-slate-200 rounded-lg p-3">
                <p class="text-xs text-slate-500 mb-2">Pré-visualização</p>
                <img [src]="logoPreview" alt="Pré-visualização da logomarca" class="h-16 object-contain" />
              </div>
            </div>
            <p class="text-xs text-slate-500">Imagens quadradas funcionam melhor na tela de login.</p>
          </div>

          <div class="field-stack">
            <label class="text-sm font-medium text-slate-700" for="logomarcaRelatorio">Imagem para relatórios (PDF)</label>
            <div class="flex flex-col md:flex-row md:items-center gap-3">
              <div class="flex items-center gap-3">
                <input
                  id="logomarcaRelatorio"
                  type="file"
                  accept="image/*"
                  class="input"
                  (change)="onReportLogoSelected($event)"
                />
                <button type="button" class="btn-outline" (click)="clearReportLogo()" *ngIf="reportLogoPreview">Remover</button>
              </div>
              <div *ngIf="reportLogoPreview" class="bg-slate-50 border border-slate-200 rounded-lg p-3">
                <p class="text-xs text-slate-500 mb-2">Pré-visualização</p>
                <img [src]="reportLogoPreview" alt="Pré-visualização da imagem para relatórios" class="h-16 object-contain" />
              </div>
            </div>
            <p class="text-xs text-slate-500">Use uma versão horizontal ou em alta resolução para relatórios e PDFs.</p>
          </div>
        </div>

        <div class="field-stack md:col-span-2">
          <label class="text-sm font-medium text-slate-700" for="razaoSocial">Razão social</label>
          <input id="razaoSocial" type="text" formControlName="razaoSocial" class="input" placeholder="Nome empresarial" />
          <p *ngIf="form.get('razaoSocial')?.touched && form.get('razaoSocial')?.invalid" class="text-xs text-red-500">
            Informe a razão social da instituição.
          </p>
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="cnpj">CNPJ</label>
          <input id="cnpj" type="text" formControlName="cnpj" class="input" placeholder="00.000.000/0000-00" />
          <p *ngIf="form.get('cnpj')?.touched && form.get('cnpj')?.invalid" class="text-xs text-red-500">Informe um CNPJ.</p>
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="telefone">Telefone</label>
          <input
            id="telefone"
            type="text"
            formControlName="telefone"
            class="input"
            placeholder="(00) 00000-0000"
            (input)="onPhoneInput($event)"
          />
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="email">E-mail</label>
          <input id="email" type="email" formControlName="email" class="input" placeholder="contato@unidade.com" />
          <p *ngIf="form.get('email')?.touched && form.get('email')?.invalid" class="text-xs text-red-500">
            Informe um e-mail válido.
          </p>
        </div>

        <div class="field-stack md:col-span-2">
          <label class="text-sm font-medium text-slate-700" for="horarioFuncionamento">Horário de funcionamento</label>
          <input
            id="horarioFuncionamento"
            type="text"
            formControlName="horarioFuncionamento"
            class="input"
            placeholder="Ex.: Segunda a sexta, das 8h às 17h"
          />
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="cep">CEP</label>
          <input
            id="cep"
            type="text"
            formControlName="cep"
            class="input"
            placeholder="00000-000"
            inputmode="numeric"
            maxlength="9"
            (input)="onCepInput($event)"
          />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 compact-grid md:col-span-2">
          <div class="field-stack md:col-span-2">
            <label class="text-sm font-medium text-slate-700" for="endereco">Endereço</label>
            <input id="endereco" type="text" formControlName="endereco" class="input" placeholder="Rua, avenida..." />
          </div>

          <div class="field-stack">
            <label class="text-sm font-medium text-slate-700" for="numeroEndereco">Número</label>
            <input id="numeroEndereco" type="text" formControlName="numeroEndereco" class="input" placeholder="Número" />
          </div>
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="bairro">Bairro</label>
          <input id="bairro" type="text" formControlName="bairro" class="input" placeholder="Bairro" />
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="cidade">Cidade</label>
          <input id="cidade" type="text" formControlName="cidade" class="input" placeholder="Cidade" />
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="estado">Estado</label>
          <select id="estado" formControlName="estado" class="input">
            <option value="">Selecione...</option>
            <option *ngFor="let uf of estados" [value]="uf">{{ uf }}</option>
          </select>
        </div>

        <div class="field-stack md:col-span-2">
          <label class="text-sm font-medium text-slate-700" for="responsavelNome">Diretor(a) / coordenador(a) / presidente</label>
          <input
            id="responsavelNome"
            type="text"
            formControlName="responsavelNome"
            class="input"
            placeholder="Nome completo do responsável"
          />
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="responsavelCpf">CPF do responsável</label>
          <input
            id="responsavelCpf"
            type="text"
            formControlName="responsavelCpf"
            class="input"
            placeholder="000.000.000-00"
            inputmode="numeric"
            maxlength="14"
            (input)="onCpfInput($event)"
          />
          <p *ngIf="form.get('responsavelCpf')?.touched && form.get('responsavelCpf')?.invalid" class="text-xs text-red-500">
            Informe um CPF válido.
          </p>
        </div>

        <div class="field-stack">
          <label class="text-sm font-medium text-slate-700" for="responsavelPeriodoMandato">Período de mandato</label>
          <input
            id="responsavelPeriodoMandato"
            type="text"
            formControlName="responsavelPeriodoMandato"
            class="input"
            placeholder="Ex.: 2024 - 2026"
          />
        </div>

        <div class="field-stack md:col-span-2">
          <label class="text-sm font-medium text-slate-700" for="observacoes">Observações</label>
          <textarea
            id="observacoes"
            formControlName="observacoes"
            rows="3"
            class="input"
            placeholder="Instruções internas, horário de atendimento, etc."
          ></textarea>
        </div>
      </div>

      <div class="flex items-center justify-between gap-3">
        <button type="button" class="btn-outline" (click)="resetForm()">Cancelar</button>
        <div class="flex gap-2.5">
          <button type="button" class="btn-outline" *ngIf="unidade?.id" (click)="delete()">Excluir unidade</button>
          <button type="submit" class="btn-primary">{{ unidade ? 'Atualizar unidade' : 'Salvar unidade' }}</button>
        </div>
      </div>
    </form>
  </div>

  <div class="card card--compact">
    <div class="card__header-row">
      <div class="card__header">Dados atuais da unidade</div>
      <button type="button" class="btn-outline" *ngIf="unidade" (click)="printUnit()">Imprimir dados</button>
    </div>
    <p class="text-sm text-slate-600" *ngIf="!unidade">Nenhuma unidade cadastrada até o momento.</p>
    <div *ngIf="unidade" class="data-grid">
      <div class="md:col-span-2 flex items-center gap-3" *ngIf="unidade.logomarca">
        <span class="font-semibold">Logomarca:</span>
        <img [src]="unidade.logomarca" alt="Logomarca da unidade" class="h-12 object-contain" />
      </div>
      <div class="md:col-span-2 flex items-center gap-3" *ngIf="unidade.logomarcaRelatorio">
        <span class="font-semibold">Imagem dos relatórios:</span>
        <img [src]="unidade.logomarcaRelatorio" alt="Imagem utilizada em relatórios" class="h-12 object-contain" />
      </div>
      <p><span class="font-semibold">Nome fantasia:</span> {{ unidade.nomeFantasia }}</p>
      <p><span class="font-semibold">Razão social:</span> {{ unidade.razaoSocial || 'Não informada' }}</p>
      <p><span class="font-semibold">CNPJ:</span> {{ unidade.cnpj || 'Não informado' }}</p>
      <p><span class="font-semibold">Telefone:</span> {{ unidade.telefone || 'Não informado' }}</p>
      <p><span class="font-semibold">E-mail:</span> {{ unidade.email || 'Não informado' }}</p>
      <p><span class="font-semibold">Horário de funcionamento:</span> {{ unidade.horarioFuncionamento || 'Não informado' }}</p>
      <p><span class="font-semibold">CEP:</span> {{ unidade.cep || 'Não informado' }}</p>
      <p><span class="font-semibold">Cidade/Estado:</span> {{ unidade.cidade || 'Sem cidade' }} / {{ unidade.estado || 'UF' }}</p>
      <p><span class="font-semibold">Período de mandato:</span> {{ unidade.responsavelPeriodoMandato || 'Não informado' }}</p>
      <p class="md:col-span-2"><span class="font-semibold">Endereço:</span> {{ unidade.endereco }} {{ unidade.numeroEndereco }}</p>
      <p><span class="font-semibold">Bairro:</span> {{ unidade.bairro || 'Não informado' }}</p>
      <p class="md:col-span-2"><span class="font-semibold">Responsável:</span> {{ unidade.responsavelNome || 'Não informado' }}</p>
      <p><span class="font-semibold">CPF:</span> {{ unidade.responsavelCpf || 'Não informado' }}</p>
      <p class="md:col-span-2"><span class="font-semibold">Observações:</span> {{ unidade.observacoes || 'Nenhuma' }}</p>
    </div>
  </div>
</div>
