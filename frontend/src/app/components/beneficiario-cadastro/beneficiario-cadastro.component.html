<section class="cadastro">
  <header class="page-title">
    <p class="page-title__eyebrow">Beneficiário</p>
    <p class="page-title__label">Cadastro de beneficiário</p>
  </header>

  <div class="tab-shell">
    <p class="tab-shell__title">Navegue pelas informações</p>
    <ol class="step-tabs" role="tablist">
      <li
        *ngFor="let tab of tabs; index as idx"
        class="step-tabs__item"
        [class.active]="activeTab === tab.id"
        [class.completed]="idx < activeTabIndex"
      >
        <button
          class="step-tabs__button"
          type="button"
          role="tab"
          [attr.aria-selected]="activeTab === tab.id"
          (click)="changeTab(tab.id)"
        >
          <span class="step-tabs__index">{{ idx + 1 }}</span>
          <span class="step-tabs__label">{{ tab.label }}</span>
        </button>
      </li>
    </ol>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form-shell">
    <div *ngIf="feedback" class="feedback">{{ feedback }}</div>

    <ng-template #navigationControls>
      <div class="tab-actions">
        <button type="button" class="ghost" *ngIf="hasPreviousTab" (click)="goToPreviousTab()">Voltar</button>
        <button type="button" class="primary" *ngIf="hasNextTab" (click)="goToNextTab()">
          Próximo: {{ nextTabLabel }}
        </button>
        <button type="submit" class="primary" [disabled]="saving" *ngIf="!hasNextTab">
          {{ saving ? 'Salvando...' : 'Salvar cadastro' }}
        </button>
      </div>
    </ng-template>

    <div class="tab-card" *ngIf="activeTab === 'dados'" formGroupName="dadosPessoais">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('dados') }}</p>
          <p class="muted">Campos essenciais como nome, data de nascimento e responsáveis.</p>
        </div>
        <span class="pill">Obrigatório</span>
      </div>
      <div class="status-strip status-strip--embedded">
        <div>
          <p class="status-strip__label">Status do beneficiário</p>
          <div class="status-strip__current">
            <span [ngClass]="getStatusClass(form.get('status')?.value)">{{ formatStatusLabel(form.get('status')?.value) }}</span>
            <span class="status-strip__reason" *ngIf="form.get('motivo_bloqueio')?.value">
              Motivo: {{ form.get('motivo_bloqueio')?.value }}
            </span>
          </div>
        </div>
        <div class="status-strip__controls">
          <label class="field">
            <span>Atualizar status</span>
            <select formControlName="status">
              <option *ngFor="let option of statusOptions" [value]="option">{{ formatStatusLabel(option) }}</option>
            </select>
          </label>
          <button type="button" class="ghost" *ngIf="form.get('status')?.value === 'BLOQUEADO'" (click)="blockReasonModalOpen = true">
            Editar motivo do bloqueio
          </button>
        </div>
      </div>
      <div class="photo-section">
        <div class="photo-preview" [class.photo-preview--empty]="!photoPreview">
          <img *ngIf="photoPreview" [src]="photoPreview" alt="Foto 3x4 do beneficiário" />
          <span *ngIf="!photoPreview">Foto 3x4 do beneficiário</span>
        </div>
        <div class="photo-actions">
          <label class="upload-btn">
            Enviar foto 3x4
            <input type="file" accept="image/*" (change)="onPhotoSelected($event)" />
          </label>
          <button type="button" class="ghost" (click)="handleCameraCapture()">
            {{ cameraActive ? 'Registrar foto' : 'Capturar pela câmera' }}
          </button>
          <button type="button" class="ghost" *ngIf="photoPreview" (click)="removePhoto()">Remover foto</button>
          <button type="button" class="ghost" *ngIf="cameraActive" (click)="stopCamera()">Fechar câmera</button>
          <p class="photo-hint">Aceite arquivos enviados ou registre uma nova foto pela webcam.</p>
          <p *ngIf="captureError" class="field-error">{{ captureError }}</p>
        </div>
      </div>
      <div class="camera-view" *ngIf="cameraActive">
        <video #videoElement autoplay muted playsinline></video>
      </div>
      <canvas #canvasElement class="capture-canvas"></canvas>
      <div class="field-grid cols-2">
        <label class="field full">Nome completo*<input formControlName="nome_completo" placeholder="Digite o nome completo" /></label>
        <label class="field">Nome social<input formControlName="nome_social" placeholder="Se houver" /></label>
        <label class="field">Apelido<input formControlName="apelido" placeholder="Como prefere ser chamado" /></label>
        <div class="field date-field">
          <label class="field">Data de nascimento*<input type="date" formControlName="data_nascimento" /></label>
          <p class="age-hint" *ngIf="beneficiaryAge !== null">{{ beneficiaryAge }} anos</p>
        </div>
        <label class="field">Sexo biológico<select formControlName="sexo_biologico">
            <option value=""></option>
            <option value="MASCULINO">Masculino</option>
            <option value="FEMININO">Feminino</option>
            <option value="OUTRO">Outro</option>
          </select></label>
        <label class="field">Identidade de gênero<select formControlName="identidade_genero">
            <option value=""></option>
            <option *ngFor="let option of genderIdentityOptions" [value]="option">{{ option }}</option>
          </select></label>
        <label class="field">Cor/Raça<select formControlName="cor_raca">
            <option value=""></option>
            <option value="BRANCA">Branca</option>
            <option value="PRETA">Preta</option>
            <option value="PARDA">Parda</option>
            <option value="AMARELA">Amarela</option>
            <option value="INDIGENA">Indígena</option>
            <option value="NAO_INFORMADO">Não informado</option>
          </select></label>
        <label class="field">Estado civil<select formControlName="estado_civil">
            <option value=""></option>
            <option *ngFor="let option of maritalStatusOptions" [value]="option">{{ option }}</option>
          </select></label>
        <div class="field-grid cols-3 compact full-span">
          <label class="field">Nacionalidade<select formControlName="nacionalidade">
              <option value=""></option>
              <option *ngFor="let option of nationalityOptions" [value]="option">{{ option }}</option>
            </select></label>
          <label class="field">Naturalidade (cidade)<input formControlName="naturalidade_cidade" /></label>
          <label class="field">Estado<input maxlength="2" formControlName="naturalidade_uf" /></label>
        </div>
      <label class="field full">Nome da mãe*<input formControlName="nome_mae" /></label>
      <label class="field full">Nome do pai<input formControlName="nome_pai" /></label>
    </div>

    <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
  </div>

    <section class="list-panel" *ngIf="activeTab === 'dados'">
      <div class="list-panel__header">
        <div>
          <p class="list-panel__eyebrow">Base cadastrada</p>
          <h2>Encontre beneficiários cadastrados</h2>
          <p>Busque pelo nome, CPF ou NIS e selecione para editar, alterar ou excluir.</p>
        </div>
        <div class="list-panel__actions">
          <button type="button" class="ghost" (click)="searchForm.reset({ status: '' }); searchBeneficiaries()">
            Limpar filtros
          </button>
          <button type="button" class="primary" (click)="searchBeneficiaries()">Buscar</button>
        </div>
      </div>

      <form [formGroup]="searchForm" class="list-panel__filters" (ngSubmit)="searchBeneficiaries()">
        <label class="field">
          Nome
          <input type="text" formControlName="nome" placeholder="Digite parte do nome" />
        </label>
        <label class="field">
          CPF
          <input type="text" formControlName="cpf" placeholder="Somente números" />
        </label>
        <label class="field">
          NIS
          <input type="text" formControlName="nis" placeholder="Somente números" />
        </label>
        <label class="field">
          Status
          <select formControlName="status">
            <option value="">Todos</option>
            <option *ngFor="let option of statusOptions" [value]="option">{{ formatStatusLabel(option) }}</option>
          </select>
        </label>
        <div class="list-panel__filter-actions">
          <button type="submit" class="primary">Aplicar filtros</button>
        </div>
      </form>

      <div *ngIf="listError" class="feedback">{{ listError }}</div>
      <div *ngIf="listLoading" class="list-panel__loading">Carregando beneficiários...</div>

      <div class="list-panel__table" *ngIf="!listLoading">
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>CPF</th>
              <th>Nascimento</th>
              <th>Status</th>
              <th class="text-right">Ações</th>
            </tr>
          </thead>
          <tbody *ngIf="filteredBeneficiarios.length; else emptyList">
              <tr *ngFor="let beneficiario of filteredBeneficiarios">
                <td>{{ beneficiario.nome_completo || beneficiario.nome_social }}</td>
              <td>{{ beneficiario.cpf || beneficiario.nis || '---' }}</td>
              <td>{{ beneficiario.data_nascimento ? (beneficiario.data_nascimento | date : 'dd/MM/yyyy') : '---' }}</td>
              <td><span [ngClass]="getStatusClass(beneficiario.status)">{{ formatStatusLabel(beneficiario.status) }}</span></td>
              <td class="text-right actions">
                <button type="button" class="ghost" (click)="selectBeneficiario(beneficiario)">Selecionar</button>
                <button type="button" class="ghost" (click)="editBeneficiario(beneficiario)">Editar</button>
                <button type="button" class="danger" (click)="deleteBeneficiario(beneficiario)">Excluir</button>
              </td>
            </tr>
          </tbody>
        </table>
        <ng-template #emptyList>
          <tbody>
            <tr>
              <td colspan="5" class="list-panel__empty">Nenhum beneficiário encontrado com os filtros informados.</td>
            </tr>
          </tbody>
        </ng-template>
      </div>
    </section>

    <div class="tab-card" *ngIf="activeTab === 'endereco'" formGroupName="endereco">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('endereco') }}</p>
          <p class="muted">Preferencialmente utilize o endereço da família para evitar inconsistências.</p>
        </div>
        <label class="checkbox-field">
          <input type="checkbox" formControlName="usa_endereco_familia" />
          <span>Usar endereço da família</span>
        </label>
      </div>
      <div class="field-grid cols-3">
        <label class="field">CEP*<input formControlName="cep" placeholder="00000-000" (input)="onCepInput($event)" (blur)="onCepBlur()" />
          <p class="field-error" *ngIf="form.get(['endereco', 'cep'])?.invalid && form.get(['endereco', 'cep'])?.touched">
            Informe um CEP válido com 8 dígitos.
          </p>
          <p class="field-error" *ngIf="cepLookupError">{{ cepLookupError }}</p>
        </label>
        <label class="field">Logradouro<input formControlName="logradouro" /></label>
        <label class="field">Número<input formControlName="numero" /></label>
        <label class="field">Complemento<input formControlName="complemento" /></label>
        <label class="field">Bairro<input formControlName="bairro" /></label>
        <label class="field">Ponto de referência<input formControlName="ponto_referencia" /></label>
        <label class="field">Município<input formControlName="municipio" /></label>
        <label class="field">Estado<input maxlength="2" formControlName="uf" /></label>
        <label class="field">Zona<select formControlName="zona">
            <option value="URBANA">Urbana</option>
            <option value="RURAL">Rural</option>
          </select></label>
        <label class="field">Situação do imóvel<select formControlName="situacao_imovel">
            <option value=""></option>
            <option *ngFor="let option of situacaoImovelOptions" [value]="option">{{ option }}</option>
          </select></label>
        <div class="field-grid cols-3 compact full-span">
          <label class="field">Tipo de moradia<select formControlName="tipo_moradia">
              <option value=""></option>
              <option *ngFor="let option of tipoMoradiaOptions" [value]="option">{{ option }}</option>
            </select></label>
          <label class="field">Esgoto<select formControlName="esgoto_tipo">
              <option value=""></option>
              <option value="REDE">Rede</option>
              <option value="FOSSA">Fossa</option>
              <option value="CEU_ABERTO">Céu aberto</option>
              <option value="NAO_POSSUI">Não possui</option>
            </select></label>
          <label class="field">Coleta de lixo<select formControlName="coleta_lixo">
              <option value=""></option>
              <option value="REGULAR">Regular</option>
              <option value="IRREGULAR">Irregular</option>
              <option value="NAO_POSSUI">Não possui</option>
            </select></label>
        </div>
        <div class="feature-grid">
          <label class="checkbox-field"><input type="checkbox" formControlName="agua_encanada" /> <span>Água encanada</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="energia_eletrica" /> <span>Energia elétrica</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="internet" /> <span>Internet</span></label>
        </div>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'contato'" formGroupName="contato">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('contato') }}</p>
          <p class="muted">Cadastre diferentes formas de contato e preferências.</p>
        </div>
      </div>
      <div class="field-grid cols-3">
        <label class="field">Telefone principal*<input
            formControlName="telefone_principal"
            placeholder="(00) 00000-0000"
            (input)="onPhoneInput($event, 'telefone_principal')"
          />
          <p class="field-error" *ngIf="form.get(['contato', 'telefone_principal'])?.invalid && form.get(['contato', 'telefone_principal'])?.touched">
            Informe o telefone principal.
          </p>
        </label>
        <label class="field">Telefone secundário<input formControlName="telefone_secundario" placeholder="(00) 00000-0000" (input)="onPhoneInput($event, 'telefone_secundario')" /></label>
        <label class="field">Email<input type="email" formControlName="email" />
          <p class="field-error" *ngIf="form.get(['contato', 'email'])?.invalid && form.get(['contato', 'email'])?.touched">
            Informe um e-mail válido.
          </p>
        </label>
        <label class="checkbox-field"><input type="checkbox" formControlName="telefone_principal_whatsapp" /> <span>Telefone principal tem WhatsApp</span></label>
        <label class="field">Nome para recado<input formControlName="telefone_recado_nome" /></label>
        <label class="field">Telefone para recado<input formControlName="telefone_recado_numero" placeholder="(00) 00000-0000" (input)="onPhoneInput($event, 'telefone_recado_numero')" /></label>
        <label class="field">Horário preferencial<select formControlName="horario_preferencial_contato">
            <option value=""></option>
            <option *ngFor="let option of preferredContactOptions" [value]="option.value">{{ option.label }}</option>
          </select></label>
        <div class="feature-grid">
          <label class="checkbox-field"><input type="checkbox" formControlName="permite_contato_tel" /> <span>Permite contato telefônico</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="permite_contato_whatsapp" /> <span>Permite WhatsApp</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="permite_contato_sms" /> <span>Permite SMS</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="permite_contato_email" /> <span>Permite e-mail</span></label>
        </div>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'documentos'" formGroupName="documentos">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('documentos') }}</p>
          <p class="muted">Organize CPF, RG, certidões e demais identificadores.</p>
        </div>
      </div>
      <div class="field-grid cols-3">
        <label class="field">CPF*<input formControlName="cpf" (input)="onCpfInput($event)" />
          <p class="field-error" *ngIf="form.get(['documentos', 'cpf'])?.invalid && form.get(['documentos', 'cpf'])?.touched">
            Informe um CPF válido.
          </p>
        </label>
        <label class="field">RG número<input formControlName="rg_numero" /></label>
        <label class="field">Órgão emissor<input formControlName="rg_orgao_emissor" /></label>
        <label class="field">Estado<input maxlength="2" formControlName="rg_uf" /></label>
        <label class="field">Data emissão<input type="date" formControlName="rg_data_emissao" /></label>
        <label class="field">NIS<input formControlName="nis" /></label>
        <label class="field">Certidão tipo<input formControlName="certidao_tipo" /></label>
        <label class="field">Livro<input formControlName="certidao_livro" /></label>
        <label class="field">Folha<input formControlName="certidao_folha" /></label>
        <label class="field">Termo<input formControlName="certidao_termo" /></label>
        <label class="field">Cartório<input formControlName="certidao_cartorio" /></label>
        <label class="field">Município<input formControlName="certidao_municipio" /></label>
        <label class="field">Estado<input maxlength="2" formControlName="certidao_uf" /></label>
        <label class="field">Título de eleitor<input formControlName="titulo_eleitor" /></label>
        <label class="field">CNH<input formControlName="cnh" /></label>
        <label class="field">Cartão SUS<input formControlName="cartao_sus" /></label>
      </div>
      <div class="document-section" formArrayName="anexos">
        <div class="document-section__header">
          <div>
            <h4>Envio de comprovantes</h4>
            <p>Os documentos obrigatórios são definidos em Configurações &gt; Documentos obrigatórios.</p>
          </div>
          <button type="button" class="ghost" (click)="addOptionalDocument()">Adicionar documento opcional</button>
        </div>
        <div class="document-grid">
          <div
            class="document-card"
            *ngFor="let control of anexos.controls; index as i"
            [formGroupName]="i"
            [class.document-card--alert]="control.get('obrigatorio')?.value && !control.get('nomeArquivo')?.value"
          >
            <div class="document-card__header">
              <div>
                <p class="document-card__title">{{ control.get('nome')?.value }}</p>
                <p class="document-card__subtitle" *ngIf="control.get('obrigatorio')?.value">Obrigatório para concluir o cadastro</p>
              </div>
              <span *ngIf="control.get('obrigatorio')?.value" class="pill">Obrigatório</span>
            </div>
            <div class="document-card__body">
              <label class="field">Nome do documento<input formControlName="nome" /></label>
              <p class="doc-status">
                {{ control.get('nomeArquivo')?.value || 'Nenhum arquivo selecionado' }}
              </p>
              <label class="upload-btn">
                Enviar arquivo
                <input type="file" (change)="onDocumentFileSelected($event, i)" />
              </label>
            </div>
          </div>
        </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
      </div>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'familiar'" formGroupName="familiar">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('familiar') }}</p>
          <p class="muted">Mapa da convivência familiar e condições de vulnerabilidade.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="checkbox-field"><input type="checkbox" formControlName="mora_com_familia" /> <span>Mora com a família</span></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="responsavel_legal" /> <span>Responsável legal</span></label>
        <label class="field">Vínculo familiar<input formControlName="vinculo_familiar" /></label>
        <label class="field">Composição familiar<textarea formControlName="composicao_familiar"></textarea></label>
        <label class="field">Crianças/adolescentes no domicílio<input type="number" formControlName="criancas_adolescentes" /></label>
        <label class="field">Idosos no domicílio<input type="number" formControlName="idosos" /></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="acompanhamento_cras" /> <span>Em acompanhamento do CRAS/CREAS</span></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="acompanhamento_saude" /> <span>Em acompanhamento pela saúde (e-SUS)</span></label>
        <label class="field">Participação comunitária<input formControlName="participa_comunidade" placeholder="Conselhos, grupos, coletivos" /></label>
        <label class="field">Rede de apoio<textarea formControlName="rede_apoio" placeholder="Instituições, vizinhos, familiares"></textarea></label>
        <label class="field full">Situação de vulnerabilidade<textarea formControlName="situacao_vulnerabilidade"></textarea></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'escolaridade'" formGroupName="escolaridade">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('escolaridade') }}</p>
          <p class="muted">Entenda a escolaridade, ocupação e fontes de renda.</p>
        </div>
      </div>
      <div class="field-grid cols-3">
        <label class="checkbox-field"><input type="checkbox" formControlName="sabe_ler_escrever" /> <span>Sabe ler e escrever</span></label>
        <label class="field">Nível de escolaridade<input formControlName="nivel_escolaridade" /></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="estuda_atualmente" /> <span>Estuda atualmente</span></label>
        <label class="field">Ocupação
          <input
            formControlName="ocupacao"
            placeholder="Informe a ocupação"
          />
        </label>
        <label class="field">Situação de trabalho<input formControlName="situacao_trabalho" /></label>
        <label class="field">Local de trabalho<input formControlName="local_trabalho" /></label>
        <label class="field">Renda mensal
          <input
            type="text"
            formControlName="renda_mensal"
            (input)="formatCurrency($event, 'escolaridade', 'renda_mensal')"
            placeholder="R$ 0,00"
          />
        </label>
        <label class="field">Fonte de renda<input formControlName="fonte_renda" /></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'saude'" formGroupName="saude">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('saude') }}</p>
          <p class="muted">Registro de deficiências, medicações e referência de atendimento.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="checkbox-field"><input type="checkbox" formControlName="possui_deficiencia" /> <span>Possui deficiência</span></label>
        <label class="field">Tipo de deficiência<input formControlName="tipo_deficiencia" /></label>
        <label class="field">CID principal<input formControlName="cid_principal" /></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="usa_medicacao_continua" /> <span>Usa medicação contínua</span></label>
        <label class="field full">Descrição da medicação<textarea formControlName="descricao_medicacao"></textarea></label>
        <label class="field">Serviço de saúde de referência<input formControlName="servico_saude_referencia" /></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'beneficios'" formGroupName="beneficios">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('beneficios') }}</p>
          <p class="muted">Indique benefícios ativos e valores aproximados.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="checkbox-field"><input type="checkbox" formControlName="recebe_beneficio" /> <span>Recebe benefício</span></label>
        <label class="field">Valor total
          <input type="text" formControlName="valor_total_beneficios" (input)="formatCurrency($event)" placeholder="R$ 0,00" />
        </label>
        <div class="field full">
          <p class="field-title">Benefícios recebidos</p>
          <div class="chips">
            <label *ngFor="let benefit of availableBenefits" class="chip">
              <input type="checkbox" [checked]="selectionChecked(benefit)" (change)="toggleBenefit(benefit)" />
              <span>{{ benefit }}</span>
            </label>
          </div>
        </div>
        <label class="field full">Descrição dos benefícios<textarea formControlName="beneficios_descricao"></textarea></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'observacoes'" formGroupName="observacoes">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ getTabLabel('observacoes') }}</p>
          <p class="muted">Últimos apontamentos para complementar o cadastro.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="field">Data do aceite<input type="datetime-local" formControlName="data_aceite_lgpd" /></label>
        <label class="checkbox-field"><input type="checkbox" formControlName="aceite_lgpd" (change)="handleLgpdToggle($event)" /> <span>Aceite LGPD*</span></label>
        <label class="field full">Observações<textarea formControlName="observacoes"></textarea></label>
        <p class="field-error full-span" *ngIf="form.get(['observacoes', 'aceite_lgpd'])?.invalid && form.get(['observacoes', 'aceite_lgpd'])?.touched">
          Confirme o aceite LGPD para continuar.
        </p>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>
  </form>

  <div class="modal" *ngIf="blockReasonModalOpen">
    <div class="modal__backdrop"></div>
    <div class="modal__content">
      <h3>Motivo do bloqueio</h3>
      <p class="muted">Descreva o motivo para manter o registro bloqueado.</p>
        <textarea [formControl]="motivoBloqueioControl" rows="4"></textarea>
      <p *ngIf="blockReasonError" class="field-error">{{ blockReasonError }}</p>
      <div class="modal__actions">
        <button type="button" class="ghost" (click)="cancelBlockReason()">Cancelar</button>
        <button type="button" class="primary" (click)="confirmBlockReason()">Salvar motivo</button>
      </div>
    </div>
  </div>
</section>
