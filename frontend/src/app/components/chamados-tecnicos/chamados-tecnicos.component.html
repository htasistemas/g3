<app-tela-padrao
  [acoes]="acoesToolbar"
  [mostrarFechar]="true"
  [fullWidth]="true"
  (buscar)="onBuscar()"
  (novo)="onNovo()"
  (fechar)="onFechar()"
>
  <section class="cadastro">
    <div class="cadastro-layout">
      <aside class="cadastro-menu">
        <div class="tab-shell">
          <p class="tab-shell__title tab-shell__title--destaque">
            <fa-icon [icon]="faHeadset" class="tab-shell__icon"></fa-icon>
            Chamados técnicos
          </p>
          <ol class="step-tabs" role="tablist">
            <li class="step-tabs__item active">
              <button type="button" class="step-tabs__button" role="tab" aria-selected="true">
                <span class="step-tabs__index">1</span>
                <span class="step-tabs__label">Listagem</span>
              </button>
            </li>
          </ol>
        </div>
      </aside>

      <div class="cadastro-conteudo">
        <app-popup-messages [mensagens]="popupErros" (fechar)="popupErros = []"></app-popup-messages>

        <section class="list-panel">
          <div class="tab-card__header">
            <div class="tab-card__title-stack">
              <p class="tab-card__highlight">Listagem</p>
              <p class="muted">Clique duas vezes em um chamado para abrir.</p>
            </div>
          </div>
          <div class="tab-card__divider"></div>

          <form class="list-panel__filters">
            <label class="field">
              Status
              <select
                name="statusSelecionado"
                [(ngModel)]="statusSelecionado"
                [ngModelOptions]="{ standalone: true }"
                (ngModelChange)="onSelecionarStatus($event)"
              >
                <option value="">Todos</option>
                <option *ngFor="let option of statusOptions" [value]="option">{{ formatStatus(option) }}</option>
              </select>
            </label>
            <label class="field field--checkbox">
              <span>Resolvidos</span>
              <input
                type="checkbox"
                name="filtroResolvidos"
                [(ngModel)]="filtrarResolvidos"
                [ngModelOptions]="{ standalone: true }"
                (ngModelChange)="onSelecionarResolvidos($event)"
              />
            </label>
            <label class="field field--checkbox">
              <span>Fechados</span>
              <input
                type="checkbox"
                name="filtroFechados"
                [(ngModel)]="filtrarFechados"
                [ngModelOptions]="{ standalone: true }"
                (ngModelChange)="onSelecionarFechados($event)"
              />
            </label>
            <label class="field full">
              Texto
              <input
                type="text"
                name="textoFiltro"
                [(ngModel)]="textoFiltro"
                [ngModelOptions]="{ standalone: true }"
                (ngModelChange)="onTextoChange($event)"
                placeholder="Título, código ou descrição"
              />
            </label>
          </form>

          <div *ngIf="erroLista" class="feedback">
            <span>{{ erroLista }}</span>
            <button type="button" class="feedback__close" (click)="erroLista = null" aria-label="Fechar aviso">
              &times;
            </button>
          </div>

          <div *ngIf="carregando" class="list-panel__loading">Carregando chamados...</div>

          <div class="unit-list" *ngIf="chamados.length; else emptyList">
            <div class="unit-list__item" *ngFor="let chamado of chamados" (dblclick)="abrirChamado(chamado)">
              <div class="unit-list__row">
                <span class="unit-list__code unit-list__code--fixed">{{ chamado.codigo || '---' }}</span>
                <span class="unit-list__status" [ngClass]="statusClass(chamado.status)">{{ formatStatus(chamado.status) }}</span>
                <span class="unit-list__prioridade" [ngClass]="prioridadeClass(chamado.prioridade)">{{ formatPrioridade(chamado.prioridade) }}</span>
                <span class="unit-list__title">{{ chamado.titulo }}</span>
                <span class="unit-list__meta">Módulo: {{ chamado.modulo || '---' }}</span>
                <span class="unit-list__meta">Cliente: {{ chamado.cliente || '---' }}</span>
                <span class="unit-list__meta">Responsável: {{ chamado.responsavel_usuario_id || '---' }}</span>
              </div>
            </div>
          </div>
          <ng-template #emptyList>
            <p class="muted">Nenhum chamado encontrado.</p>
          </ng-template>

          <div class="unit-list__pagination" *ngIf="total > tamanhoPagina">
            <span class="unit-list__total">Total: {{ total }} chamados</span>
            <button type="button" class="btn-outline" (click)="paginaAnterior()" [disabled]="pagina === 1">
              Anterior
            </button>
            <span class="unit-list__page">Página {{ pagina }} de {{ totalPaginas }}</span>
            <button type="button" class="btn-outline" (click)="proximaPagina()" [disabled]="pagina >= totalPaginas">
              Próximo
            </button>
          </div>
        </section>
      </div>
    </div>
  </section>
</app-tela-padrao>
