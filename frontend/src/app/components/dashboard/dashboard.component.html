<div class="p-6 space-y-6">
  <div class="bg-gradient-to-r from-g3-green-700 to-emerald-500 text-white rounded-2xl shadow-md p-6 flex flex-col gap-4">
    <div class="flex flex-wrap items-center gap-3">
      <div class="bg-white/15 rounded-lg p-3">
        <span class="material-icons">dashboard_customize</span>
      </div>
      <div>
        <h1 class="text-2xl font-semibold">Dashboard Assistencia Social</h1>
        <p class="text-white/80">Indicadores consolidados de beneficiarios, familias e termos de fomento.</p>
      </div>
    </div>
  </div>

  <div *ngIf="error && !loading" class="bg-white rounded-xl border border-rose-200 shadow-sm p-6 text-rose-700">
    <p class="font-semibold">Falha ao carregar o dashboard.</p>
    <p class="text-sm">{{ error }}</p>
  </div>

  <ng-container *ngIf="!loading && cadastros; else loadingState">
    <div class="grid gap-4 lg:grid-cols-3 md:grid-cols-2 mt-4" *ngIf="financeiro">
      <div class="stat-card stat-card--center" *ngFor="let card of [
          { label: 'Valores a receber', value: financeiro.valoresAReceber, icon: 'account_balance_wallet', hint: 'Titulos abertos em cobranca.', tone: 'stat-card--emerald', route: 'financeiro/contabilidade', formato: 'moeda' },
          { label: 'Valores em bancos', value: financeiro.valoresEmCaixa, icon: 'payments', hint: 'Saldo disponivel em contas correntes.', tone: 'stat-card--indigo', route: 'financeiro/contabilidade', formato: 'moeda' },
          { label: 'Tarefas e pendencias', value: pendenciasAbertas, icon: 'assignment_late', hint: 'Pendencias abertas na gestao de tarefas.', tone: 'stat-card--sky', route: 'administrativo/tarefas', formato: 'numero' }
        ]" [ngClass]="card.tone">
        <div class="stat-card__icon">
          <button type="button" class="stat-card__icon-button" (click)="navegarPara(card.route)" [attr.aria-label]="card.label">
            <span class="material-icons">{{ card.icon }}</span>
          </button>
        </div>
        <div>
          <p class="stat-card__label">{{ card.label }}</p>
          <p class="stat-card__value" *ngIf="card.formato === 'moeda'; else valorNumero">{{ card.value | currency: 'BRL' }}</p>
          <ng-template #valorNumero>
            <p class="stat-card__value">{{ card.value }}</p>
          </ng-template>
          <p class="stat-card__hint">{{ card.hint }}</p>
        </div>
      </div>
    </div>

    <div class="grid gap-4 lg:grid-cols-5 md:grid-cols-2">
      <div class="stat-card stat-card--center" *ngFor="let card of [
          { label: 'Beneficiarios cadastrados', value: cadastros.beneficiarios, icon: 'groups', hint: 'Pessoas registradas no sistema.', tone: 'stat-card--emerald', route: 'cadastros/beneficiarios' },
          { label: 'Profissionais cadastrados', value: cadastros.profissionais, icon: 'badge', hint: 'Equipe tecnica ativa no cadastro.', tone: 'stat-card--indigo', route: 'cadastros/profissionais' },
          { label: 'Voluntarios cadastrados', value: cadastros.voluntarios, icon: 'volunteer_activism', hint: 'Apoio voluntario cadastrado.', tone: 'stat-card--amber', route: 'cadastros/voluntariados' },
          { label: 'Familias cadastradas', value: cadastros.familias, icon: 'diversity_3', hint: 'Nucleos familiares registrados.', tone: 'stat-card--rose', route: 'cadastros/vinculo-familiar' },
          { label: 'Bens cadastrados', value: cadastros.bensPatrimonio, icon: 'inventory_2', hint: 'Itens registrados no patrimonio.', tone: 'stat-card--sky', route: 'administrativo/patrimonio' }
        ]" [ngClass]="card.tone">
        <div class="stat-card__icon">
          <button type="button" class="stat-card__icon-button" (click)="navegarPara(card.route)" [attr.aria-label]="card.label">
            <span class="material-icons">{{ card.icon }}</span>
          </button>
        </div>
        <div>
          <p class="stat-card__label">{{ card.label }}</p>
          <p class="stat-card__value">{{ card.value }}</p>
          <p class="stat-card__hint">{{ card.hint }}</p>
        </div>
      </div>
    </div>

    <div class="grid gap-4 lg:grid-cols-4 md:grid-cols-2 mt-4">
      <div class="stat-card stat-card--center" *ngFor="let card of [
          { label: 'Doacoes realizadas', value: doacoesRealizadas, icon: 'inventory_2', hint: 'Entregas registradas no periodo.', tone: 'stat-card--emerald', route: 'atendimentos/doacoes' },
          { label: 'Empregos abertos', value: empregosAbertos, icon: 'work_outline', hint: 'Vagas disponiveis para encaminhar.', tone: 'stat-card--sky', route: 'atendimentos/banco-empregos' },
          { label: 'Cursos com vagas', value: cursosComVagas, icon: 'school', hint: 'Turmas com vagas abertas.', tone: 'stat-card--indigo', route: 'atendimentos/cursos' },
          { label: 'Itens no almoxarifado', value: itensAlmoxarifado, icon: 'inventory', hint: 'Produtos cadastrados em estoque.', tone: 'stat-card--amber', route: 'administrativo/almoxarifado' }
        ]" [ngClass]="card.tone">
        <div class="stat-card__icon">
          <button type="button" class="stat-card__icon-button" (click)="navegarPara(card.route)" [attr.aria-label]="card.label">
            <span class="material-icons">{{ card.icon }}</span>
          </button>
        </div>
        <div>
          <p class="stat-card__label">{{ card.label }}</p>
          <p class="stat-card__value">{{ card.value }}</p>
          <p class="stat-card__hint">{{ card.hint }}</p>
        </div>
      </div>
    </div>

    <div class="chart-grid" *ngIf="financeiro || cadastros">
      <div class="chart-card chart-card--single" *ngIf="financeiro">
        <div class="chart-card__header">
          <p class="chart-card__title">Valores a receber</p>
          <span class="chart-card__hint">Financeiro</span>
        </div>
        <div class="chart-donut chart-donut--emerald" [style.--percent.%]="percentualAReceber">
          <div class="chart-donut__center">
            <span class="chart-donut__value">{{ percentualAReceber | number: '1.0-0' }}%</span>
            <span class="chart-donut__label">A receber</span>
          </div>
        </div>
        <p class="chart-highlight">{{ financeiro.valoresAReceber | currency: 'BRL' }}</p>
        <p class="chart-card__subhint">Proporcao sobre o total financeiro.</p>
      </div>

      <div class="chart-card chart-card--single" *ngIf="cadastros">
        <div class="chart-card__header">
          <p class="chart-card__title">Beneficiarios cadastrados</p>
          <span class="chart-card__hint">Cadastros</span>
        </div>
        <div class="chart-spark">
          <div class="chart-spark__line"></div>
          <span class="chart-spark__marker" [style.left.%]="percentualBeneficiarios"></span>
          <span class="chart-spark__value">{{ percentualBeneficiarios | number: '1.0-0' }}%</span>
        </div>
        <p class="chart-highlight">{{ cadastros.beneficiarios }}</p>
        <p class="chart-card__subhint">Proporcao sobre cadastros totais.</p>
      </div>

      <div class="chart-card chart-card--single" *ngIf="cadastros">
        <div class="chart-card__header">
          <p class="chart-card__title">Voluntarios cadastrados</p>
          <span class="chart-card__hint">Cadastros</span>
        </div>
        <div class="chart-pie chart-pie--amber" [style.--percent.%]="percentualVoluntarios">
          <span class="chart-pie__value">{{ percentualVoluntarios | number: '1.0-0' }}%</span>
        </div>
        <p class="chart-highlight">{{ cadastros.voluntarios }}</p>
        <p class="chart-card__subhint">Proporcao sobre cadastros totais.</p>
      </div>
    </div>
  </ng-container>

  <ng-template #loadingState>
    <div class="bg-white rounded-xl border border-slate-100 shadow-sm p-6 flex items-center gap-3 text-slate-700">
      <span class="material-icons animate-spin">refresh</span>
      <p>Carregando dados atualizados do painel...</p>
    </div>
  </ng-template>
</div>
