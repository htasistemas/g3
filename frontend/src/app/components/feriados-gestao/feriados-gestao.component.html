<app-tela-padrao
  [acoes]="acoesToolbar"
  [desabilitado]="acoesDesabilitadas"
  [mostrarFechar]="true"
  [fullWidth]="true"
  (salvar)="submit()"
  (excluir)="excluirSelecionado()"
  (novo)="startNew()"
  (cancelar)="resetForm()"
  (imprimir)="imprimirLista()"
  (buscar)="onBuscar()"
  (fechar)="closeForm()"
>
  <app-popup-messages [mensagens]="popupErros" [titulo]="popupTitulo" (fechar)="fecharPopupErros()"></app-popup-messages>

  <section class="cadastro">
    <div class="cadastro-layout">
      <aside class="cadastro-menu">
        <div class="tab-shell">
          <p class="tab-shell__title tab-shell__title--destaque">
            <fa-icon [icon]="faCalendarDay" class="tab-shell__icon"></fa-icon>
            Feriados
          </p>
          <ol class="step-tabs" role="tablist">
            <li
              *ngFor="let tab of tabs; index as idx"
              class="step-tabs__item"
              [class.active]="activeTab === tab.id"
              [class.completed]="idx < activeTabIndex"
            >
              <button
                class="step-tabs__button"
                type="button"
                role="tab"
                [attr.aria-selected]="activeTab === tab.id"
                (click)="changeTab(tab.id)"
              >
                <span class="step-tabs__index">{{ idx + 1 }}</span>
                <span class="step-tabs__label">{{ tab.label }}</span>
              </button>
            </li>
          </ol>
        </div>
      </aside>

      <div class="cadastro-conteudo">
        <form [formGroup]="form" (ngSubmit)="submit()" class="form-shell">
          <ng-template #navigationControls>
            <div class="tab-actions">
              <button type="button" class="ghost" *ngIf="hasPreviousTab" (click)="goToPreviousTab()">Voltar</button>
              <button type="button" class="primary" *ngIf="hasNextTab" (click)="goToNextTab()">
                Próximo: {{ nextTabLabel }}
              </button>
              <button type="submit" class="primary" [disabled]="saving" *ngIf="!hasNextTab">
                {{ saving ? 'Salvando...' : 'Salvar feriado' }}
              </button>
            </div>
          </ng-template>

          <div class="tab-card" *ngIf="activeTab === 'cadastro'">
            <div class="tab-card__header">
              <div class="tab-card__title-stack">
                <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
              </div>
            </div>
            <div class="tab-card__divider"></div>

            <div class="field-grid cols-2">
              <label class="field">Data*
                <input type="date" formControlName="data" />
              </label>
              <label class="field">Descrição*
                <input formControlName="descricao" placeholder="Ex.: Feriado municipal" />
              </label>
            </div>

            <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
          </div>

          <div class="tab-card" *ngIf="activeTab === 'listagem'">
            <div class="tab-card__header">
              <div class="tab-card__title-stack">
                <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
              </div>
            </div>
            <div class="tab-card__divider"></div>

            <div class="filter-panel" [formGroup]="filtroForm">
              <label class="field">Data
                <input type="date" formControlName="data" />
              </label>
              <label class="field">Descrição
                <input formControlName="descricao" placeholder="Digite parte da descrição" />
              </label>
              <div class="filter-panel__actions">
                <button type="button" class="primary" (click)="aplicarFiltro()">Buscar</button>
                <button type="button" class="ghost" (click)="limparFiltro()">Limpar</button>
              </div>
            </div>

            <div class="list-card">
              <div class="list-card__header">
                <div>
                  <p class="list-card__eyebrow">Registros</p>
                  <p class="list-card__title">Feriados cadastrados</p>
                </div>
                <div class="list-card__actions">
                  <button type="button" class="ghost" (click)="imprimirLista()">Imprimir</button>
                </div>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let feriado of feriadosFiltrados" (click)="selecionarFeriado(feriado)">
                    <td>{{ feriado.data }}</td>
                    <td>{{ feriado.descricao }}</td>
                  </tr>
                  <tr *ngIf="!feriadosFiltrados.length">
                    <td colspan="2" class="empty">Nenhum feriado encontrado.</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
          </div>
        </form>
      </div>
    </div>
  </section>
</app-tela-padrao>
