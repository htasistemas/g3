<app-tela-padrao>
  <header class="page-title" slot="titulo">
    <p class="page-title__eyebrow">Georeferenciamento</p>
    <p class="page-title__label">Localizacao</p>
    <p class="page-title__note">Mapa e registro de localizacoes georreferenciadas.</p>
  </header>

  <section class="cadastro georef-page">
    <div class="form-shell">
      <div class="tab-card" *ngIf="activeTab === 'beneficiarios'">
        <div class="tab-card__header">
          <div class="tab-card__title-stack">
            <p class="tab-card__highlight">Localizacao de Beneficiarios</p>
            <p class="muted">Localizacao dos beneficiarios cadastrados no sistema.</p>
          </div>
        </div>

        <div class="card__content">
          <div *ngIf="erroTabs.beneficiarios" class="error">{{ erroTabs.beneficiarios }}</div>
          <div *ngIf="avisoTabs.beneficiarios" class="warning">{{ avisoTabs.beneficiarios }}</div>
          <div *ngIf="carregandoTabs.beneficiarios" class="loading">Carregando beneficiarios...</div>
          <div class="field-grid cols-2">
            <label class="field">
              Beneficiario
              <select
                [(ngModel)]="beneficiarioSelecionadoId"
                (ngModelChange)="onBeneficiarioSelecionado()"
              >
                <option [value]="''">Selecione</option>
                <option [value]="'TODOS'">Todos os beneficiarios</option>
                <option *ngFor="let beneficiario of beneficiarios" [value]="beneficiario.id_beneficiario">
                  {{ beneficiario.nome_completo || beneficiario.nome_social || 'Beneficiario' }}
                </option>
              </select>
            </label>
          </div>
        </div>
      </div>
    </div>
  </section>
</app-tela-padrao>

<div class="modal" *ngIf="mapaModalOpen">
  <div class="modal__backdrop" (click)="fecharMapaEndereco()"></div>
  <div class="modal__content modal__content--wide">
    <div class="modal__header">
      <div>
        <p class="modal__eyebrow">Endereco</p>
        <h3>Localizacao no Google Maps</h3>
      </div>
      <button type="button" class="ghost" (click)="fecharMapaEndereco()" aria-label="Fechar">&times;</button>
    </div>
    <iframe
      *ngIf="mapaEnderecoUrl"
      [src]="mapaEnderecoUrl"
      width="100%"
      height="520"
      style="border:0;"
      allowfullscreen=""
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
    ></iframe>
    <div class="modal__actions">
      <a
        class="btn-outline"
        [href]="mapaEnderecoLink"
        target="_blank"
        rel="noopener"
        *ngIf="mapaEnderecoLink"
      >
        Abrir no Google Maps
      </a>
      <button
        type="button"
        class="ghost"
        *ngIf="beneficiarioSelecionadoId === 'TODOS' && totalLotes > 1"
        [disabled]="loteAtual === 0"
        (click)="abrirLoteAnterior()"
      >
        Parte anterior
      </button>
      <button
        type="button"
        class="ghost"
        *ngIf="beneficiarioSelecionadoId === 'TODOS' && totalLotes > 1"
        [disabled]="loteAtual >= totalLotes - 1"
        (click)="abrirProximoLote()"
      >
        Proxima parte
      </button>
      <button type="button" class="primary" (click)="fecharMapaEndereco()">Fechar</button>
    </div>
  </div>
</div>


