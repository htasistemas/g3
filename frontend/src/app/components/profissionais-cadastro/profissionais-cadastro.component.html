<section class="cadastro">
  <header class="page-title">
    <p class="page-title__eyebrow">Cadastros</p>
    <div class="page-title__heading">
      <p class="page-title__label">Profissionais para atendimentos</p>
      <p class="page-title__description">
        Registre e acompanhe profissionais responsáveis pelos atendimentos presenciais ou remotos.
      </p>
    </div>
    <div class="highlight-strip">
      <span>Time disponível</span>
      <strong>{{ totalDisponiveis }} profissionais prontos para atender</strong>
    </div>
  </header>

  <div class="metrics-row">
    <div class="metric-card">
      <p class="metric-card__label">Profissionais disponíveis</p>
      <p class="metric-card__value">{{ totalDisponiveis }}</p>
      <p class="metric-card__hint">Prontos para novos atendimentos</p>
    </div>
    <div class="metric-card gradient">
      <p class="metric-card__label">Atendimento presencial</p>
      <p class="metric-card__value">{{ totalPresencial }}</p>
      <p class="metric-card__hint">Ativos em sala ou campo</p>
    </div>
    <div class="metric-card gradient-alt">
      <p class="metric-card__label">Atendimento online</p>
      <p class="metric-card__value">{{ totalOnline }}</p>
      <p class="metric-card__hint">Teleatendimento e orientações</p>
    </div>
  </div>

  <section class="form-layout">
    <div class="form-panel">
      <div class="panel-header">
        <div>
          <p class="panel-eyebrow">Cadastro</p>
          <h2>{{ editingId ? 'Editar profissional' : 'Novo profissional' }}</h2>
          <p class="muted">Complete os campos para habilitar o profissional na agenda de atendimentos.</p>
        </div>
        <span class="status-pill" [class.success]="!editingId">{{ editingId ? 'Edição' : 'Rascunho' }}</span>
      </div>

      <form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">
        <div class="field">
          <label>Nome completo *</label>
          <input type="text" formControlName="nome" placeholder="Quem irá atender?" />
        </div>
        <div class="field">
          <label>Categoria *</label>
          <select formControlName="categoria">
            <option *ngFor="let categoria of categorias" [value]="categoria">{{ categoria }}</option>
          </select>
        </div>
        <div class="field">
          <label>Especialidade</label>
          <input type="text" formControlName="especialidade" placeholder="Área principal de atuação" />
        </div>
        <div class="field">
          <label>Registro em conselho</label>
          <input type="text" formControlName="registroConselho" placeholder="CRESS, CRP, CRM..." />
        </div>
        <div class="field">
          <label>E-mail *</label>
          <input type="email" formControlName="email" placeholder="contato@instituicao.org.br" />
        </div>
        <div class="field">
          <label>Telefone/WhatsApp</label>
          <input type="text" formControlName="telefone" placeholder="(11) 90000-0000" />
        </div>
        <div class="field">
          <label>Unidade de atendimento</label>
          <input type="text" formControlName="unidade" placeholder="Unidade, polo ou sala" />
        </div>
        <div class="field">
          <label>Carga horária semanal</label>
          <input type="number" formControlName="cargaHoraria" min="1" placeholder="Horas disponíveis" />
        </div>

        <div class="field full">
          <p class="field__label">Disponibilidade</p>
          <div class="chips">
            <button
              type="button"
              class="chip"
              [class.active]="selectionChecked(['disponibilidade'], periodo)"
              *ngFor="let periodo of disponibilidades"
              (click)="toggleSelection(['disponibilidade'], periodo)"
            >
              {{ periodo }}
            </button>
          </div>
        </div>

        <div class="field full">
          <p class="field__label">Canais de atendimento</p>
          <div class="chips">
            <button
              type="button"
              class="chip"
              [class.active]="selectionChecked(['canaisAtendimento'], canal)"
              *ngFor="let canal of canais"
              (click)="toggleSelection(['canaisAtendimento'], canal)"
            >
              {{ canal }}
            </button>
          </div>
        </div>

        <div class="field">
          <label>Status *</label>
          <select formControlName="status">
            <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
          </select>
        </div>

        <div class="field">
          <label>Palavras-chave</label>
          <div class="tag-input">
            <input
              type="text"
              placeholder="Digite e pressione Enter"
              #tagInput
              (keydown.enter)="addTag(tagInput.value); tagInput.value = ''; $event.preventDefault();"
            />
            <div class="tag-suggestions">
              <button type="button" *ngFor="let tag of tagsSugeridas" (click)="addTag(tag)">{{ tag }}</button>
            </div>
          </div>
          <div class="tag-list" *ngIf="form.value.tags?.length">
            <span class="tag" *ngFor="let tag of form.value.tags">
              {{ tag }}
              <button type="button" (click)="removeTag(tag)">×</button>
            </span>
          </div>
        </div>

        <div class="field">
          <label>Resumo breve</label>
          <textarea formControlName="resumo" rows="2" placeholder="Como este profissional contribui?" ></textarea>
        </div>
        <div class="field">
          <label>Observações internas</label>
          <textarea formControlName="observacoes" rows="2" placeholder="Notas de equipe e agenda"></textarea>
        </div>
      </form>

      <div class="form-actions">
        <button type="button" class="ghost" (click)="resetForm()">Limpar</button>
        <button type="button" class="secondary" (click)="editingId ? resetForm() : null">Cancelar</button>
        <button type="button" class="primary" (click)="submit()">
          {{ editingId ? 'Salvar alterações' : 'Cadastrar profissional' }}
        </button>
      </div>
      <p class="feedback" *ngIf="feedback">{{ feedback }}</p>
    </div>

    <div class="list-panel">
      <div class="panel-header compact">
        <div>
          <p class="panel-eyebrow">Escala e agenda</p>
          <h3>Profissionais cadastrados</h3>
          <p class="muted">Organize quem atende em cada canal ou período.</p>
        </div>
        <div class="filters">
          <span class="pill">{{ professionals.length }} profissionais</span>
          <span class="pill success">{{ totalDisponiveis }} disponíveis</span>
        </div>
      </div>

      <div class="professional-list">
        <article class="professional-card" *ngFor="let professional of professionals">
          <div class="professional-card__header">
            <div>
              <p class="title">{{ professional.nome }}</p>
              <p class="subtitle">{{ professional.categoria }} • {{ professional.especialidade || 'Sem especialidade' }}</p>
            </div>
            <span class="pill" [class.success]="professional.status === 'Disponível'">{{ professional.status }}</span>
          </div>

          <div class="professional-card__meta">
            <span>{{ professional.unidade || 'Unidade não informada' }}</span>
            <span>{{ professional.cargaHoraria || 'Carga não definida' }}h/semana</span>
            <span>{{ professional.canaisAtendimento?.join(' • ') || 'Sem canais definidos' }}</span>
          </div>

          <p class="professional-card__resume" *ngIf="professional.resumo">{{ professional.resumo }}</p>

          <div class="tag-list inline" *ngIf="professional.tags?.length">
            <span class="tag" *ngFor="let tag of professional.tags">{{ tag }}</span>
          </div>

          <div class="professional-card__footer">
            <div class="contact">
              <span>{{ professional.email || 'E-mail não informado' }}</span>
              <span>{{ professional.telefone || 'Telefone não informado' }}</span>
            </div>
            <div class="actions">
              <button type="button" class="ghost" (click)="edit(professional)">Editar</button>
              <button type="button" class="danger" (click)="remove(professional)">Remover</button>
            </div>
          </div>
        </article>

        <p class="muted" *ngIf="!professionals.length">Nenhum profissional cadastrado ainda.</p>
      </div>
    </div>
  </section>
</section>
