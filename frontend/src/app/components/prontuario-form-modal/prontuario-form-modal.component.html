<div class="modal" *ngIf="aberto">
  <div class="modal__overlay" (click)="close()"></div>
  <div class="modal__content">
    <header class="modal__header">
      <h3>{{ registro ? 'Editar registro' : 'Novo registro' }}</h3>
      <button type="button" class="ghost" (click)="close()">Fechar</button>
    </header>

    <form [formGroup]="formulario" (ngSubmit)="submit()" class="modal__form">
      <div class="form-grid">
        <label class="form-field">
          <span>Tipo*</span>
          <select class="select" formControlName="tipo">
            <option value="atendimento">Atendimento</option>
            <option value="procedimento">Procedimento</option>
            <option value="evolucao">EvoluÃ§Ã£o</option>
            <option value="encaminhamento">Encaminhamento</option>
            <option value="documento">Documento/Anexo</option>
            <option value="outro">Outro</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('tipo')">{{ mensagemErro('tipo') }}</p>
        </label>

        <label class="form-field" *ngIf="tipoSelecionado !== 'atendimento' && tipoSelecionado !== 'documento'">
          <span>Data e hora*</span>
          <input type="datetime-local" class="input" formControlName="dataRegistro" />
          <p class="form-error" *ngIf="mostrarErro('dataRegistro')">{{ mensagemErro('dataRegistro') }}</p>
        </label>

        <label class="form-field" *ngIf="tipoSelecionado === 'atendimento'">
          <span>Data e hora (inÃ­cio)*</span>
          <input type="datetime-local" class="input" formControlName="dataInicio" />
          <p class="form-error" *ngIf="mostrarErro('dataInicio')">{{ mensagemErro('dataInicio') }}</p>
        </label>

        <label class="form-field" *ngIf="tipoSelecionado === 'atendimento'">
          <span>Data e hora (fim)*</span>
          <input type="datetime-local" class="input" formControlName="dataFim" />
          <p class="form-error" *ngIf="mostrarErro('dataFim')">{{ mensagemErro('dataFim') }}</p>
        </label>

        <label class="form-field" *ngIf="tipoSelecionado === 'documento'">
          <span>Data do documento*</span>
          <input type="date" class="input" formControlName="dataDocumento" />
          <p class="form-error" *ngIf="mostrarErro('dataDocumento')">{{ mensagemErro('dataDocumento') }}</p>
        </label>

        <label class="form-field">
          <span>Profissional responsÃ¡vel*</span>
          <app-autocomplete
            [placeholder]="'Selecione o profissional'"
            [termo]="termoProfissional"
            [opcoes]="opcoesProfissionaisFiltradas"
            (termoChange)="atualizarTermoProfissional($event)"
            (selecionar)="selecionarProfissional($event)"
          ></app-autocomplete>
          <p class="form-error" *ngIf="mostrarErro('profissionalId')">{{ mensagemErro('profissionalId') }}</p>
        </label>

        <label class="form-field">
          <span>Unidade</span>
          <select class="select" formControlName="unidadeId">
            <option [ngValue]="''">Selecione</option>
            <option *ngFor="let unidade of opcoesUnidades" [ngValue]="unidade.id">
              {{ unidade.label }}
            </option>
          </select>
        </label>

        <label class="form-field">
          <span>FamÃ­lia de referÃªncia</span>
          <input type="number" class="input" formControlName="familiaId" placeholder="ID da famÃ­lia" />
        </label>

        <label class="form-field" *ngIf="tipoSelecionado !== 'documento'">
          <span>TÃ­tulo</span>
          <input type="text" class="input" formControlName="titulo" placeholder="Resumo do registro" />
        </label>

        <label class="form-field">
          <span>Status*</span>
          <select class="select" formControlName="status">
            <option value="aberto">Aberto</option>
            <option value="concluido">ConcluÃ­do</option>
            <option value="cancelado">Cancelado</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('status')">{{ mensagemErro('status') }}</p>
        </label>

        <label class="form-field">
          <span>NÃ­vel de sigilo</span>
          <select class="select" formControlName="nivelSigilo">
            <option value="Normal">Normal</option>
            <option value="Reservado">Reservado</option>
            <option value="Sigiloso">Sigiloso</option>
          </select>
        </label>
      </div>

      <div class="form-grid" *ngIf="tipoSelecionado === 'atendimento'">
        <label class="form-field">
          <span>Tipo de atendimento*</span>
          <select class="select" formControlName="tipoAtendimento">
            <option value="">Selecione</option>
            <option value="Individual">Individual</option>
            <option value="Familiar">Familiar</option>
            <option value="Grupo">Grupo</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('tipoAtendimento')">{{ mensagemErro('tipoAtendimento') }}</p>
        </label>
        <label class="form-field">
          <span>Local do atendimento*</span>
          <select class="select" formControlName="localAtendimento">
            <option value="">Selecione</option>
            <option value="Unidade">Unidade</option>
            <option value="Remoto">Remoto</option>
            <option value="Outro">Outro</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('localAtendimento')">{{ mensagemErro('localAtendimento') }}</p>
        </label>
        <label class="form-field">
          <span>ServiÃ§o/Programa*</span>
          <input type="text" class="input" formControlName="servicoPrograma" placeholder="PAIF, PAEFI, etc." />
          <p class="form-error" *ngIf="mostrarErro('servicoPrograma')">{{ mensagemErro('servicoPrograma') }}</p>
        </label>
        <label class="form-field">
          <span>Motivo/Demanda principal*</span>
          <input type="text" class="input" formControlName="motivoDemanda" />
          <p class="form-error" *ngIf="mostrarErro('motivoDemanda')">{{ mensagemErro('motivoDemanda') }}</p>
        </label>
        <label class="form-field">
          <span>ClassificaÃ§Ã£o de risco*</span>
          <select class="select" formControlName="classificacaoRisco">
            <option value="">Selecione</option>
            <option value="Baixo">Baixo</option>
            <option value="Moderado">Moderado</option>
            <option value="Alto">Alto</option>
            <option value="CrÃ­tico">CrÃ­tico</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('classificacaoRisco')">{{ mensagemErro('classificacaoRisco') }}</p>
        </label>
        <label class="form-field">
          <span>Resultado do atendimento*</span>
          <input type="text" class="input" formControlName="resultadoAtendimento" />
          <p class="form-error" *ngIf="mostrarErro('resultadoAtendimento')">{{ mensagemErro('resultadoAtendimento') }}</p>
        </label>
        <label class="form-field">
          <span>PrÃ³ximos passos*</span>
          <input type="text" class="input" formControlName="proximosPassos" />
          <p class="form-error" *ngIf="mostrarErro('proximosPassos')">{{ mensagemErro('proximosPassos') }}</p>
        </label>
      </div>

      <div class="form-grid" *ngIf="tipoSelecionado === 'procedimento'">
        <label class="form-field">
          <span>Tipo de procedimento*</span>
          <input type="text" class="input" formControlName="tipoProcedimento" />
          <p class="form-error" *ngIf="mostrarErro('tipoProcedimento')">{{ mensagemErro('tipoProcedimento') }}</p>
        </label>
        <label class="form-field">
          <span>VÃ­nculo com outro registro</span>
          <input type="text" class="input" formControlName="vinculoRegistro" placeholder="Tipo/ID do registro" />
        </label>
      </div>

      <div class="form-grid" *ngIf="tipoSelecionado === 'evolucao'">
        <label class="form-field">
          <span>Resumo da evoluÃ§Ã£o*</span>
          <input type="text" class="input" formControlName="titulo" />
          <p class="form-error" *ngIf="mostrarErro('titulo')">{{ mensagemErro('titulo') }}</p>
        </label>
        <label class="form-field">
          <span>SituaÃ§Ã£o atual*</span>
          <select class="select" formControlName="situacaoAtual">
            <option value="">Selecione</option>
            <option value="Melhorou">Melhorou</option>
            <option value="Estavel">EstÃ¡vel</option>
            <option value="Piorou">Piorou</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('situacaoAtual')">{{ mensagemErro('situacaoAtual') }}</p>
        </label>
        <label class="form-field">
          <span>PendÃªncias ou aÃ§Ãµes futuras</span>
          <input type="text" class="input" formControlName="pendencias" />
        </label>
      </div>

      <div class="form-grid" *ngIf="tipoSelecionado === 'encaminhamento'">
        <label class="form-field">
          <span>Destino*</span>
          <input type="text" class="input" formControlName="destinoEncaminhamento" />
          <p class="form-error" *ngIf="mostrarErro('destinoEncaminhamento')">{{ mensagemErro('destinoEncaminhamento') }}</p>
        </label>
        <label class="form-field">
          <span>Motivo*</span>
          <input type="text" class="input" formControlName="motivoEncaminhamento" />
          <p class="form-error" *ngIf="mostrarErro('motivoEncaminhamento')">{{ mensagemErro('motivoEncaminhamento') }}</p>
        </label>
        <label class="form-field">
          <span>Prioridade*</span>
          <select class="select" formControlName="prioridadeEncaminhamento">
            <option value="">Selecione</option>
            <option value="Baixa">Baixa</option>
            <option value="Media">MÃ©dia</option>
            <option value="Alta">Alta</option>
            <option value="Urgente">Urgente</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('prioridadeEncaminhamento')">{{ mensagemErro('prioridadeEncaminhamento') }}</p>
        </label>
        <label class="form-field">
          <span>Status*</span>
          <select class="select" formControlName="statusEncaminhamento">
            <option value="">Selecione</option>
            <option value="Aberto">Aberto</option>
            <option value="Em andamento">Em andamento</option>
            <option value="Concluido">ConcluÃ­do</option>
            <option value="Nao efetivado">NÃ£o efetivado</option>
            <option value="Cancelado">Cancelado</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('statusEncaminhamento')">{{ mensagemErro('statusEncaminhamento') }}</p>
        </label>
        <label class="form-field">
          <span>Prazo previsto para retorno*</span>
          <input type="date" class="input" formControlName="prazoRetorno" />
          <p class="form-error" *ngIf="mostrarErro('prazoRetorno')">{{ mensagemErro('prazoRetorno') }}</p>
        </label>
        <label class="form-field">
          <span>Forma de encaminhamento*</span>
          <select class="select" formControlName="formaEncaminhamento">
            <option value="">Selecione</option>
            <option value="Oficio">OfÃ­cio</option>
            <option value="Email">E-mail</option>
            <option value="Telefone">Telefone</option>
            <option value="Presencial">Presencial</option>
            <option value="Sistema">Sistema</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('formaEncaminhamento')">{{ mensagemErro('formaEncaminhamento') }}</p>
        </label>
      </div>

      <div class="form-grid" *ngIf="tipoSelecionado === 'documento'">
        <label class="form-field">
          <span>Tipo do documento*</span>
          <input type="text" class="input" formControlName="tipoDocumento" />
          <p class="form-error" *ngIf="mostrarErro('tipoDocumento')">{{ mensagemErro('tipoDocumento') }}</p>
        </label>
        <label class="form-field">
          <span>Origem*</span>
          <select class="select" formControlName="origemDocumento">
            <option value="">Selecione</option>
            <option value="Beneficiario">BeneficiÃ¡rio</option>
            <option value="Instituicao">InstituiÃ§Ã£o</option>
            <option value="Rede">Rede</option>
            <option value="Profissional">Profissional</option>
          </select>
          <p class="form-error" *ngIf="mostrarErro('origemDocumento')">{{ mensagemErro('origemDocumento') }}</p>
        </label>
        <label class="form-field">
          <span>VÃ­nculo com registro</span>
          <input type="text" class="input" formControlName="vinculoRegistro" placeholder="Tipo/ID do registro" />
        </label>
        <label class="form-field">
          <span>Arquivo</span>
          <input
            type="file"
            class="input"
            accept=".pdf,.jpg,.jpeg,.png,.webp,.doc,.docx,.odt,.xls,.xlsx,.ods,.txt"
            (change)="onArquivoSelecionado($event)"
          />
        </label>
      </div>

      <label class="form-field">
        <span>{{ getLabelDescricao() }}</span>
        <textarea class="input" rows="4" formControlName="descricao"></textarea>
        <p class="form-error" *ngIf="mostrarErro('descricao')">{{ mensagemErro('descricao') }}</p>
      </label>

      <div class="modal__actions">
        <button type="submit" class="primary">Salvar registro</button>
        <button type="button" class="ghost" (click)="close()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

