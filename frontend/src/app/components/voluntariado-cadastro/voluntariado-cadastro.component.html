<app-tela-padrao>
<header class="page-title" slot="titulo">
    <p class="page-title__eyebrow">Voluntariado</p>
    <p class="page-title__label">Cadastro de voluntário</p>
  </header>

  <section class="cadastro">
  <div class="tab-shell">
    <p class="tab-shell__title">Navegue pelas informações</p>
    <ol class="step-tabs" role="tablist">
      <li
        *ngFor="let tab of tabs; index as idx"
        class="step-tabs__item"
        [class.active]="activeTab === tab.id"
        [class.completed]="idx < activeTabIndex"
      >
        <button
          class="step-tabs__button"
          type="button"
          role="tab"
          [attr.aria-selected]="activeTab === tab.id"
          (click)="changeTab(tab.id)"
        >
          <span class="step-tabs__index">{{ idx + 1 }}</span>
          <span class="step-tabs__label">{{ tab.label }}</span>
        </button>
      </li>
    </ol>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form-shell">
    <div *ngIf="feedback" class="feedback">{{ feedback }}</div>

    <ng-template #navigationControls>
      <div class="tab-actions">
        <button type="button" class="ghost" *ngIf="hasPreviousTab" (click)="goToPreviousTab()">Voltar</button>
        <button type="button" class="primary" *ngIf="hasNextTab" (click)="goToNextTab()">
          Próximo: {{ nextTabLabel }}
        </button>
        <button type="submit" class="primary" [disabled]="saving" *ngIf="!hasNextTab">
          {{ saving ? 'Salvando...' : 'Salvar cadastro' }}
        </button>
      </div>
    </ng-template>

    <div class="tab-card" *ngIf="activeTab === 'dados'" formGroupName="dadosPessoais">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
          <p class="muted">Identifique o voluntário com dados essenciais e motivação para atuar.</p>
          <span class="pill">Obrigatório</span>
        </div>
        <div class="nav-buttons" aria-label="Ações rápidas do voluntário">
          <button type="button" class="nav-button" (click)="printCurrentVolunteer()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M6 4.5C6 3.67157 6.67157 3 7.5 3H12.5C13.3284 3 14 3.67157 14 4.5V6H6V4.5Z"
                  fill="currentColor"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M5 6H15C16.1046 6 17 6.89543 17 8V11.5C17 12.3284 16.3284 13 15.5 13H14V14.5C14 15.3284 13.3284 16 12.5 16H7.5C6.67157 16 6 15.3284 6 14.5V13H4.5C3.67157 13 3 12.3284 3 11.5V8C3 6.89543 3.89543 6 5 6ZM7.5 8.75C7.22386 8.75 7 8.97386 7 9.25C7 9.52614 7.22386 9.75 7.5 9.75H12.5C12.7761 9.75 13 9.52614 13 9.25C13 8.97386 12.7761 8.75 12.5 8.75H7.5Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            <span class="nav-button__label">Imprimir dados</span>
          </button>
          <button type="button" class="nav-button" (click)="submit()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5 3C4.44772 3 4 3.44772 4 4V16C4 16.5523 4.44772 17 5 17H15C15.5523 17 16 16.5523 16 16V6.41421C16 6.149 15.8946 5.89464 15.7071 5.70711L13.2929 3.29289C13.1054 3.10536 12.851 3 12.5858 3H5Z"
                  stroke="currentColor"
                  stroke-width="1.25"
                />
                <path d="M7 3.5H12V7H7V3.5Z" fill="currentColor" />
                <rect x="7" y="11.5" width="6" height="3" rx="0.5" fill="currentColor" />
              </svg>
            </span>
            <span class="nav-button__label">Salvar</span>
          </button>
          <button type="button" class="nav-button" (click)="cancelEdit()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M4.5 10C4.5 7.51472 6.51472 5.5 9 5.5H12.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
                <path
                  d="M12 3.5L14.5 5.75L12 8"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M15.5 10C15.5 12.4853 13.4853 14.5 11 14.5H7.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
                <path
                  d="M8 16.5L5.5 14.25L8 12"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span class="nav-button__label">Cancelar</span>
          </button>
          <button type="button" class="nav-button nav-button--danger" *ngIf="editingVolunteerId" (click)="deleteCurrentVolunteer()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M8 3.5H12C12.2761 3.5 12.5 3.72386 12.5 4V4.5H16"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
                <path d="M4 4.5H7.5V4C7.5 3.72386 7.72386 3.5 8 3.5" stroke="currentColor" stroke-width="1.25" />
                <path
                  d="M6.5 7.5V15.5C6.5 16.0523 6.94772 16.5 7.5 16.5H12.5C13.0523 16.5 13.5 16.0523 13.5 15.5V7.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
                <path d="M9.25 9.5V14" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" />
                <path d="M10.75 9.5V14" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" />
              </svg>
            </span>
            <span class="nav-button__label">Excluir</span>
          </button>
          <button type="button" class="nav-button" (click)="startNewVolunteer()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M10 4.5V15.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M4.5 10H15.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </span>
            <span class="nav-button__label">Novo</span>
          </button>
          <button type="button" class="nav-button" (click)="closeForm()">
            <span class="nav-button__icon" aria-hidden="true">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M6.5 6.5L13.5 13.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
                <path
                  d="M13.5 6.5L6.5 13.5"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                />
              </svg>
            </span>
            <span class="nav-button__label">Fechar</span>
          </button>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="field full">Nome completo*<input formControlName="nomeCompleto" placeholder="Digite o nome completo" /></label>
        <label class="field">CPF*<input formControlName="cpf" placeholder="000.000.000-00" /></label>
        <label class="field">RG<input formControlName="rg" /></label>
        <label class="field">Data de nascimento<input type="date" formControlName="dataNascimento" /></label>
        <label class="field">Gênero<select formControlName="genero">
            <option value=""></option>
            <option value="Feminino">Feminino</option>
            <option value="Masculino">Masculino</option>
            <option value="Outro">Outro</option>
          </select></label>
        <label class="field">Profissão<input formControlName="profissao" placeholder="Área de atuação" /></label>
        <label class="field full">Motivação<textarea formControlName="motivacao" placeholder="Por que deseja atuar como voluntário?" rows="3"></textarea></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'contato'" formGroupName="contato">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
          <p class="muted">Formas de contato e competências relevantes para a atuação.</p>
        </div>
      </div>
      <div class="field-grid cols-3">
        <label class="field">Telefone<input formControlName="telefone" placeholder="(00) 00000-0000" /></label>
        <label class="field">E-mail*<input type="email" formControlName="email" placeholder="nome@email.com" /></label>
        <label class="field">Cidade<input formControlName="cidade" /></label>
        <label class="field">Estado<input maxlength="2" formControlName="estado" /></label>
        <label class="field">Área de interesse<input formControlName="areaInteresse" placeholder="Ex.: Educação, Saúde" /></label>
        <label class="field">Habilidades e experiências<textarea formControlName="habilidades" rows="3" placeholder="Atendimento, facilitação, gestão..."></textarea></label>
        <label class="field">Idiomas<input formControlName="idiomas" placeholder="Português, Inglês..." /></label>
        <label class="field">LinkedIn / Portfólio<input formControlName="linkedin" placeholder="Link para perfil profissional" /></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'disponibilidade'" formGroupName="disponibilidade">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
          <p class="muted">Combine dias, períodos e formato de atuação para alocar o voluntário.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <div class="field full">
          <p class="field-title">Dias da semana</p>
          <div class="chips">
            <label *ngFor="let dia of diasSemana" class="chip">
              <input type="checkbox" [checked]="selectionChecked(['disponibilidade', 'dias'], dia)" (change)="toggleSelection(['disponibilidade', 'dias'], dia)" />
              <span>{{ dia }}</span>
            </label>
          </div>
        </div>
        <div class="field full">
          <p class="field-title">Períodos disponíveis</p>
          <div class="chips">
            <label *ngFor="let periodo of periodos" class="chip">
              <input type="checkbox" [checked]="selectionChecked(['disponibilidade', 'periodos'], periodo)" (change)="toggleSelection(['disponibilidade', 'periodos'], periodo)" />
              <span>{{ periodo }}</span>
            </label>
          </div>
        </div>
        <label class="field">Carga horária semanal<input formControlName="cargaHorariaSemanal" placeholder="Ex.: 4h/semana" /></label>
        <label class="field">Início previsto<input type="date" formControlName="inicioPrevisto" /></label>
        <div class="feature-grid">
          <label class="checkbox-field"><input type="checkbox" formControlName="presencial" /> <span>Disponível para atuar presencialmente</span></label>
          <label class="checkbox-field"><input type="checkbox" formControlName="remoto" /> <span>Pode atuar de forma remota</span></label>
        </div>
        <label class="field full">Observações<textarea formControlName="observacoes" rows="3" placeholder="Preferências de local, restrições e recursos necessários"></textarea></label>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>

    <div class="tab-card" *ngIf="activeTab === 'termos'" formGroupName="termos">
      <div class="tab-card__header">
        <div class="tab-card__title-stack">
          <p class="tab-card__highlight">{{ tabs[activeTabIndex].label }}</p>
          <p class="muted">Formalize o aceite do termo de voluntariado e da autorização de uso de imagem.</p>
        </div>
      </div>
      <div class="field-grid cols-2">
        <label class="field">Documento de identificação<input formControlName="documentoIdentificacao" placeholder="RG ou CNH" /></label>
        <label class="field">Comprovante de endereço<input formControlName="comprovanteEndereco" placeholder="Arquivo ou protocolo" /></label>
        <div class="term-card full">
          <div class="term-card__header">
            <div>
              <p class="term-card__title">Termo de voluntariado</p>
              <p class="muted">Responsabilidades, ausência de vínculo empregatício e cuidados com segurança e confidencialidade.</p>
            </div>
            <span class="pill">Obrigatório</span>
          </div>
          <ul>
            <li>Atuação espontânea e não remunerada, regida pela Lei nº 9.608/1998, sem vínculo empregatício.</li>
            <li>Dever de confidencialidade sobre beneficiários, relatórios e informações estratégicas.</li>
            <li>Direito a capacitação, orientações de segurança e materiais necessários para a atividade.</li>
            <li>Responsabilidade de comunicar ausências, zelar por equipamentos e cumprir protocolos internos.</li>
          </ul>
          <label class="checkbox-field">
            <input type="checkbox" formControlName="aceiteVoluntariado" />
            <span>Li e aceito o termo de voluntariado</span>
          </label>
        </div>

        <div class="term-card full">
          <div class="term-card__header">
            <div>
              <p class="term-card__title">Autorização de uso de imagem</p>
              <p class="muted">Autorização detalhada para captação e divulgação de imagem e voz em materiais institucionais.</p>
            </div>
            <span class="pill">Obrigatório</span>
          </div>
          <ul>
            <li>Uso gratuito da imagem e voz em mídias digitais, impressas, transmissões e relatórios.</li>
            <li>Possibilidade de revogação futura, sem efeito retroativo sobre peças já divulgadas.</li>
            <li>Tratamento de dados pessoais em conformidade com a LGPD e políticas internas de privacidade.</li>
          </ul>
          <label class="checkbox-field">
            <input type="checkbox" formControlName="aceiteImagem" />
            <span>Autorizo o uso de imagem e voz para fins institucionais</span>
          </label>
        </div>

        <label class="field full">Assinatura digital / observações para termo<textarea formControlName="assinaturaDigital" rows="3" placeholder="Registre informações complementares ou assinatura eletrônica"></textarea></label>
        <div class="actions">
          <button class="primary" type="button" (click)="openTermo()">Gerar termo para assinatura</button>
        </div>
      </div>
      <ng-container *ngTemplateOutlet="navigationControls"></ng-container>
    </div>
  </form>

  <div class="list-card">
    <div class="list-card__header">
      <div>
        <p class="page-title__eyebrow">Voluntários cadastrados</p>
        <p class="page-title__label">Gestão e impressão</p>
      </div>
      <div class="list-card__actions">
        <button class="ghost" type="button" (click)="printVolunteerList()">Imprimir relação</button>
      </div>
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Nome</th>
            <th>Área de interesse</th>
            <th>Disponibilidade</th>
            <th>Contato</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let volunteer of volunteers; index as i">
            <td>{{ i + 1 }}</td>
            <td>
              <div class="strong">{{ volunteer.nome }}</div>
              <div class="muted">{{ volunteer.cpf }}</div>
            </td>
            <td>{{ volunteer.areaInteresse || 'Não informado' }}</td>
            <td>{{ volunteer.disponibilidadeDias?.join(', ') || 'Sem dias' }} — {{ volunteer.disponibilidadePeriodos?.join(', ') || 'Sem períodos' }}</td>
            <td>
              <div class="muted">{{ volunteer.email }}</div>
              <div class="muted">{{ volunteer.telefone || 'Sem telefone' }}</div>
            </td>
            <td class="text-right">
              <div class="table-actions">
                <button class="ghost" type="button" (click)="editVolunteer(volunteer)">Editar</button>
                <button class="danger" type="button" (click)="deleteVolunteer(volunteer)">Excluir</button>
                <button class="primary" type="button" (click)="printVolunteer(volunteer)">Imprimir ficha</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
</app-tela-padrao>

