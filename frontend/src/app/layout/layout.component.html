<div class="h-screen flex app-shell overflow-hidden">
  <aside
    class="sidebar hidden md:flex flex-col flex-shrink-0 overflow-y-auto"
    [class.sidebar--collapsed]="isSidebarCollapsed"
    (mouseenter)="handleSidebarEnter()"
    #sidebar
  >
    <div class="sidebar__header">
      <div>
        <p class="text-xs uppercase tracking-wide text-emerald-50">Unidade ativa</p>
        <h2 class="text-xl font-semibold text-white">{{ activeUnitName$ | async }}</h2>
      </div>
    </div>
    <nav class="p-4 space-y-3">
      <div
        *ngFor="let section of menuSections"
        class="menu-card"
        (mouseenter)="openSection = section.label"
      >
        <button
          type="button"
          (click)="toggleSection(section.label)"
          class="menu-card__trigger"
          [attr.title]="isSidebarCollapsed ? section.label : null"
        >
          <span class="flex items-center space-x-3">
            <fa-icon [icon]="section.icon" class="menu-section__icon text-emerald-100"></fa-icon>
            <span class="menu-card__label">{{ section.label }}</span>
          </span>
          <fa-icon
            [icon]="openSection === section.label ? faChevronUp : faChevronDown"
            class="text-emerald-50"
            *ngIf="!isSidebarCollapsed"
          ></fa-icon>
        </button>

        <div *ngIf="openSection === section.label" class="menu-card__content">
          <ng-container *ngFor="let child of section.children">
            <a
              *ngIf="child.route; else semRota"
              class="menu-link"
              [routerLink]="child.route"
              routerLinkActive="menu-link--active"
              [routerLinkActiveOptions]="{ exact: true }"
            >
              <fa-icon [icon]="child.icon" class="menu-link__icon mr-3 text-emerald-600"></fa-icon>
              <span>{{ child.label }}</span>
            </a>
            <ng-template #semRota>
              <a
                *ngIf="child.urlExterna; else staticChild"
                class="menu-link"
                [href]="child.urlExterna"
                target="_blank"
                rel="noopener"
              >
                <fa-icon [icon]="child.icon" class="menu-link__icon mr-3 text-emerald-600"></fa-icon>
                <span>{{ child.label }}</span>
              </a>
              <ng-template #staticChild>
                <div class="menu-link menu-link--static">
                  <fa-icon [icon]="child.icon" class="menu-link__icon mr-3 text-emerald-600"></fa-icon>
                  <span>{{ child.label }}</span>
                </div>
              </ng-template>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </nav>
  </aside>

  <div class="flex-1 flex flex-col min-w-0 h-screen">
    <header class="app-header">
      <div class="app-header__spacer" aria-hidden="true"></div>
      <div class="app-header__actions">
        <div class="tarefas-chip">
          <button type="button" class="tarefas-chip__button" (click)="abrirTarefas()">Tarefas</button>
          <button type="button" class="tarefas-chip__item" (click)="abrirTarefasAbertas()">
            Abertas: {{ tarefasAbertas }}
          </button>
          <button type="button" class="tarefas-chip__item tarefas-chip__item--alerta" (click)="abrirTarefasVencidas()">
            Vencidas: {{ tarefasVencidas }}
          </button>
        </div>
        <span class="user-chip">
          <fa-icon [icon]="faUserCircle" class="text-white"></fa-icon>
          <span class="capitalize">{{ username }}</span>
        </span>
        <button
          type="button"
          (click)="toggleTheme()"
          class="theme-toggle-button"
          [attr.title]="themeService.currentTheme() === 'dark' ? 'Tema claro' : 'Tema escuro'"
          [attr.aria-label]="themeService.currentTheme() === 'dark' ? 'Ativar tema claro' : 'Ativar tema escuro'"
        >
          <fa-icon [icon]="themeService.currentTheme() === 'dark' ? faSun : faMoon"></fa-icon>
        </button>
        <button type="button"
          (click)="logout()"
          class="logout-button"
        >
          <fa-icon [icon]="faRightFromBracket"></fa-icon>
          <span>Sair</span>
        </button>
      </div>
    </header>
    <main class="flex-1 overflow-y-auto">
      <div class="max-w-7xl mx-auto">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
