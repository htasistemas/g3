<div class="h-screen flex app-shell overflow-hidden">
  <aside
    class="sidebar hidden md:flex flex-col flex-shrink-0 overflow-y-auto"
    [class.sidebar--collapsed]="isSidebarCollapsed"
    (mouseenter)="handleSidebarEnter()"
    (mouseleave)="handleSidebarLeave()"
  >
    <div class="sidebar__header">
      <div>
        <p class="text-xs uppercase tracking-wide text-emerald-50">Unidade ativa</p>
        <h2 class="text-xl font-semibold text-white">{{ activeUnitName$ | async }}</h2>
      </div>
    </div>
    <nav class="p-4 space-y-3">
      <div
        *ngFor="let section of menuSections"
        class="menu-card"
        (mouseleave)="closeSection(section.label)"
        (mouseenter)="openSection = section.label"
      >
        <button
          type="button"
          (click)="toggleSection(section.label)"
          class="menu-card__trigger"
          [attr.title]="isSidebarCollapsed ? section.label : null"
        >
          <span class="flex items-center space-x-3">
            <fa-icon [icon]="section.icon" class="text-emerald-100"></fa-icon>
            <span class="menu-card__label">{{ section.label }}</span>
          </span>
          <fa-icon
            [icon]="openSection === section.label ? faChevronUp : faChevronDown"
            class="text-emerald-50"
            *ngIf="!isSidebarCollapsed"
          ></fa-icon>
        </button>

        <div *ngIf="openSection === section.label" class="menu-card__content">
          <ng-container *ngFor="let child of section.children">
            <a
              *ngIf="child.route; else staticChild"
              [routerLink]="child.route"
              class="menu-link"
            >
              <fa-icon [icon]="child.icon" class="mr-3 text-emerald-600"></fa-icon>
              <span>{{ child.label }}</span>
            </a>
            <ng-template #staticChild>
              <div class="menu-link menu-link--static">
                <fa-icon [icon]="child.icon" class="mr-3 text-emerald-600"></fa-icon>
                <span>{{ child.label }}</span>
              </div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </nav>
    <div class="sidebar__footer">
      <span class="sidebar__version-label">Versão do sistema</span>
      <span class="sidebar__version-value">{{ versionLabel }}</span>
    </div>
  </aside>

  <div class="flex-1 flex flex-col min-w-0 h-screen">
    <header class="app-header">
      <div class="space-y-1">
        <p class="text-[11px] uppercase tracking-wide text-emerald-50">Você está em</p>
        <h1 class="page-title">{{ pageTitle }}</h1>
      </div>
      <div class="flex items-center space-x-3 text-sm text-white">
        <button type="button" class="btn-ghost" (click)="toggleTheme()">
          <fa-icon [icon]="themeService.currentTheme() === 'dark' ? faSun : faMoon"></fa-icon>
          <span>Tema {{ themeLabel }}</span>
        </button>
        <span class="flex items-center space-x-2 bg-white/10 px-3 py-2 rounded-lg border border-white/30 backdrop-blur">
          <fa-icon [icon]="faUserCircle" class="text-white"></fa-icon>
          <span class="capitalize">{{ username }}</span>
        </span>
        <button
          (click)="logout()"
          class="inline-flex items-center space-x-2 px-3 py-2 rounded-lg border border-white/40 bg-white/10 hover:bg-white/20 text-white"
        >
          <fa-icon [icon]="faRightFromBracket"></fa-icon>
          <span>Sair</span>
        </button>
      </div>
    </header>
    <main class="flex-1 overflow-y-auto">
      <div class="max-w-7xl mx-auto">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
