{"ast":null,"code":"import { Client } from '@stomp/stompjs';\nimport * as SockJS from 'sockjs-client';\nimport { Subject } from 'rxjs';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nexport let ChamadaRealtimeService = /*#__PURE__*/(() => {\n  class ChamadaRealtimeService {\n    constructor() {\n      this.cliente = null;\n      this.assunto = new Subject();\n    }\n    conectar() {\n      if (!this.cliente) {\n        this.criarCliente();\n      }\n      return this.assunto.asObservable();\n    }\n    desconectar() {\n      if (this.cliente) {\n        this.cliente.deactivate();\n        this.cliente = null;\n      }\n    }\n    criarCliente() {\n      const url = `${environment.apiUrl}/ws`;\n      this.cliente = new Client({\n        webSocketFactory: () => new SockJS(url),\n        reconnectDelay: 5000\n      });\n      this.cliente.onConnect = () => {\n        this.cliente?.subscribe('/topic/chamadas', mensagem => {\n          try {\n            const payload = JSON.parse(mensagem.body);\n            this.assunto.next(payload);\n          } catch {\n            // Ignorar mensagens invalidas\n          }\n        });\n      };\n      this.cliente.activate();\n    }\n    static {\n      this.ɵfac = function ChamadaRealtimeService_Factory(t) {\n        return new (t || ChamadaRealtimeService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ChamadaRealtimeService,\n        factory: ChamadaRealtimeService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ChamadaRealtimeService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}